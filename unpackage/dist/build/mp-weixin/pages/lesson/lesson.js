"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),o=require("../../store/lesson.js"),s=require("../../store/student.js"),n=require("../../utils/constant.js"),r=require("../../utils/utils.js");var i="https://lesson-api.jc-talent.com";if(!Array){(e.resolveComponent("bruce-calendar")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-swipe-action-item")+e.resolveComponent("uni-swipe-action")+e.resolveComponent("uni-fab")+e.resolveComponent("uni-notice-bar")+e.resolveComponent("uni-data-select")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("time-range-picker")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/bruce-calendar/components/bruce-calendar/bruce-calendar.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-swipe-action/components/uni-swipe-action-item/uni-swipe-action-item.js")+(()=>"../../uni_modules/uni-swipe-action/components/uni-swipe-action/uni-swipe-action.js")+(()=>"../../uni_modules/uni-fab/components/uni-fab/uni-fab.js")+(()=>"../../uni_modules/uni-notice-bar/components/uni-notice-bar/uni-notice-bar.js")+(()=>"../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/time-range-picker/components/time-range-picker/time-range-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const a={__name:"lesson",setup(a){const u=e.ref(),l=e.ref(),d=o.useLessonStore(),c=s.useStudentStore(),m=e.ref([]),p=e.ref([]),h=e.reactive([{text:"取消",style:{backgroundColor:"#F56C6C"}}]),f=e.reactive({}),b=e.reactive({subject:{rules:[{required:!0,errorMessage:"科目不能为空"}]},teacher:{rules:[{required:!0,errorMessage:"教师不能为空"}]},classroom:{rules:[{required:!0,errorMessage:"教室不能为空"}]},date:{rules:[{required:!0,errorMessage:"日期不能为空"}]},time:{rules:[{required:!0,errorMessage:"时间不能为空"}]}}),j=e.ref(),v=()=>{j.value.open()},g=()=>{j.value.close()},w=async()=>{if(l.value){await l.value.validate()&&e.index.request({url:`${i}/students/${studentStore.id}/lessons`,method:"POST",data:f,success:()=>{e.index.showToast({title:"添加成功",icon:"success"}),setTimeout((()=>{g(),u.value.init(f.date),u.value.change()}),1500)}})}},$=e=>{const{year:t,month:o,date:s}=e;k(`${t}-${String(o).padStart(2,"0")}`,`${t}-${String(o).padStart(2,"0")}-${s}`)},S=e=>{const{year:t,month:o}=e;k(`${t}-${String(o).padStart(2,"0")}`)},_=e=>{f.time=e},q=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,C=(t,o)=>{e.index.request({url:`${i}/lessons/${t.id}`,method:"POST",data:t,success:()=>{e.index.showToast({title:o})}})},k=(t,o)=>{e.index.request({url:`${i}/students/${d.studentId}/lessons?month=${t}&date=${o}`,method:"GET",success:e=>{const{dailySchedules:t,currentSchedules:o}=e.data.data;m.value=t.map((e=>({date:e,color:"red",icon:"flag-filled"}))),p.value=o.map((e=>({id:e.lessonId,status:e.status,subject:e.subject,classroom:e.classroom,teacher:e.teacher,time:`${e.startTime}-${e.endTime}`})))}})};return e.onBeforeMount((()=>{const e=new Date;k((e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`)(e),q(e))})),(o,s)=>({a:e.sr(u,"8e3dd885-0",{k:"calRef"}),b:e.o($),c:e.o(S),d:e.p({selected:m.value,insert:!0,lunar:!0,"start-date":"2000-1-1","end-date":"2099-12-31"}),e:e.f(p.value,((o,s,n)=>e.e({a:2===o.status},2===o.status?{b:t._imports_0}:{},{c:e.t(e.unref(r.formatSubject)(o.subject)),d:e.t(o.time),e:"8e3dd885-3-"+n+",8e3dd885-2-"+n,f:e.t(o.classroom),g:"8e3dd885-4-"+n+",8e3dd885-2-"+n,h:e.t(o.teacher),i:o.id,j:e.o((t=>(t=>{e.index.showModal({title:"确认取消？",success:e=>{e.confirm&&(t.status=2,C(t,"取消成功"))}})})(o)),o.id),k:"8e3dd885-2-"+n+",8e3dd885-1",l:e.p({"right-options":h,disabled:2===o.status})}))),f:e.p({type:"home",size:"16",color:"#7f8c8d"}),g:e.p({"custom-prefix":"iconfont",type:"icon-teacher",color:"#7f8c8d"}),h:e.o(v),i:e.p({horizontal:"right"}),j:e.p({"show-icon":!0,"background-color":"#eee",color:"#888",text:"将为【"+e.unref(c).name+"】添加课程"}),k:e.o((e=>f.subject=e)),l:e.p({localdata:e.unref(n.subjectOptions),placeholder:"请选择科目",modelValue:f.subject}),m:e.p({label:"科目","label-width":"70",required:!0,name:"subject"}),n:e.o((e=>f.teacher=e)),o:e.p({placeholder:"请输入教师",modelValue:f.teacher}),p:e.p({label:"教师","label-width":"70",required:!0,name:"teacher"}),q:e.o((e=>f.classroom=e)),r:e.p({placeholder:"请输入教室",modelValue:f.classroom}),s:e.p({label:"教室","label-width":"70",required:!0,name:"classroom"}),t:e.o((e=>f.date=e)),v:e.p({start:q(new Date),type:"date",placeholder:"请选择日期",modelValue:f.date}),w:e.p({label:"日期","label-width":"70",required:!0,name:"date"}),x:e.o(_),y:e.o((e=>f.time=e)),z:e.p({modelValue:f.time}),A:e.p({label:"时间","label-width":"70",required:!0,name:"time"}),B:e.sr(l,"8e3dd885-8,8e3dd885-6",{k:"form"}),C:e.p({rules:b,model:f}),D:e.o(g),E:e.o(w),F:e.sr(j,"8e3dd885-6",{k:"popup"}),G:e.p({type:"center"})})}},u=e._export_sfc(a,[["__scopeId","data-v-8e3dd885"]]);wx.createPage(u);
