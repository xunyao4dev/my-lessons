"use strict";const e=require("../../common/vendor.js"),t=require("../../store/lesson.js"),s=require("../../store/student.js"),o=require("../../utils/constant.js"),r=require("../../utils/utils.js"),n=require("../../utils/request.js");var a="https://lesson-api.jc-talent.com";if(!Array){(e.resolveComponent("bruce-calendar")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-swipe-action-item")+e.resolveComponent("uni-swipe-action")+e.resolveComponent("uni-fab")+e.resolveComponent("uni-notice-bar")+e.resolveComponent("uni-data-select")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("time-range-picker")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/bruce-calendar/components/bruce-calendar/bruce-calendar.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-swipe-action/components/uni-swipe-action-item/uni-swipe-action-item.js")+(()=>"../../uni_modules/uni-swipe-action/components/uni-swipe-action/uni-swipe-action.js")+(()=>"../../uni_modules/uni-fab/components/uni-fab/uni-fab.js")+(()=>"../../uni_modules/uni-notice-bar/components/uni-notice-bar/uni-notice-bar.js")+(()=>"../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/time-range-picker/components/time-range-picker/time-range-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const i={__name:"lesson",setup(i){const u=e.ref(),l=e.ref(),c=e.ref();t.useLessonStore();const d=s.useStudentStore(),p=e.ref([]),m=e.ref([]),v=e.reactive([{text:"取消",style:{backgroundColor:"#F56C6C"}},{text:"完成",style:{backgroundColor:"#00f200"}}]),h=e.reactive({}),f=e.reactive({subject:{rules:[{required:!0,errorMessage:"科目不能为空"}]},type:{rules:[{required:!0,errorMessage:"课程类型不能为空"}]},teacher:{rules:[{required:!0,errorMessage:"教师不能为空"}]},classroom:{rules:[{required:!0,errorMessage:"教室不能为空"}]},date:{rules:[{required:!0,errorMessage:"日期不能为空"}]},time:{rules:[{required:!0,errorMessage:"时间不能为空"}]}}),b=e.ref(),j=e.computed((()=>o.subjectOptions.filter((e=>d.subjects.includes(e.value))))),g=o.typeOptions.filter((e=>1===e.value?d.remainHours.hours1v1>0:3===e.value&&d.remainHours.hours1v3>0)).map((e=>(1===e.value?e.text+=` (剩余：${d.remainHours.hours1v1} 课时)`:3===e.value&&(e.text+=` (剩余：${d.remainHours.hours1v3} 课时)`),e))),w=()=>{b.value.open()},y=e=>{switch(e){case 0:return"待上课";case 1:return"已上课";case 2:return"已取消"}},q=e=>{switch(e){case 0:return"is-init";case 1:return"is-approved";case 2:return"is-draft"}},$=()=>{b.value.close()},S=async()=>{if(l.value){await l.value.validate()&&e.index.requestSubscribeMessage({tmplIds:["UO10oiJFF9vEhkty7lvT7Q0DY2jXF4QdNn8WqHlVrdI","0A6-dgr7vyyrZdprmGcFEwxjpNj9vPuvRDVxw5tYI6A"],success:t=>{console.log(t),"accept"===t.UO10oiJFF9vEhkty7lvT7Q0DY2jXF4QdNn8WqHlVrdI||"accept"===t["0A6-dgr7vyyrZdprmGcFEwxjpNj9vPuvRDVxw5tYI6A"]?n.request({url:`${a}/students/${d.id}/lessons`,method:"POST",data:h,success:()=>{e.index.showToast({title:"添加成功",icon:"success"}),setTimeout((()=>{$(),u.value.init(h.date),u.value.change()}),1500)}}):e.index.showToast({title:"请允许订阅通知",icon:"error"})}})}},k=e=>{const{year:t,month:s,date:o}=e;F(`${t}-${String(s).padStart(2,"0")}`,`${t}-${String(s).padStart(2,"0")}-${o}`)},x=e=>{const{year:t,month:s}=e;F(`${t}-${String(s).padStart(2,"0")}`)},_=e=>{h.time=e},C=(t,s)=>{n.request({url:`${a}/lessons/${t.id}`,method:"POST",data:t,success:()=>{d.deductHours(t.type),e.index.showToast({title:s})}})},F=(e,t)=>{n.request({url:`${a}/students/${d.id}/lessons?month=${e}&date=${t}`,method:"GET",success:e=>{const{dailySchedules:t,currentSchedules:s}=e.data.data;p.value=t.map((e=>({date:e,color:"red",icon:"flag-filled"}))),m.value=s.map((e=>({id:e.lessonId,status:e.status,subject:e.subject,classroom:e.classroom,teacher:e.teacher,time:`${e.startTime}-${e.endTime}`})))}})};return e.onBeforeMount((()=>{const e=new Date;F((e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`)(e),(e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`)(e))})),(t,s)=>({a:e.sr(u,"622d2421-0",{k:"calRef"}),b:e.o(k),c:e.o(x),d:e.p({selected:p.value,insert:!0,lunar:!0,"start-date":"2000-1-1","end-date":"2099-12-31"}),e:e.f(m.value,((t,s,o)=>{return{a:e.t(y(t.status)),b:e.n(q(t.status)),c:e.t(e.unref(r.formatSubject)(t.subject)),d:e.t((n=t.type,1===n?"一对一":"一对三")),e:e.t(t.time),f:"622d2421-3-"+o+",622d2421-2-"+o,g:e.t(t.classroom),h:"622d2421-4-"+o+",622d2421-2-"+o,i:e.t(t.teacher),j:e.n({"freezon-course-info":0!==t.status}),k:t.id,l:e.o((s=>((t,s)=>{const{index:o}=t;0==o?e.index.showModal({title:"确认取消？",success:e=>{e.confirm&&(s.status=2,C(s,"取消成功"))}}):(s.status=1,C(s,"完成成功")),c.value.closeAll()})(s,t)),t.id),m:"622d2421-2-"+o+",622d2421-1",n:e.p({"right-options":v,disabled:0!==t.status})};var n})),f:e.p({type:"home",size:"16",color:"#7f8c8d"}),g:e.p({"custom-prefix":"iconfont",type:"icon-teacher",color:"#7f8c8d"}),h:e.sr(c,"622d2421-1",{k:"swipeRef"}),i:e.o(w),j:e.p({horizontal:"right"}),k:e.p({"show-icon":!0,"background-color":"#eee",color:"#888",text:"将为【"+e.unref(d).name+"】添加课程"}),l:e.o((e=>h.subject=e)),m:e.p({localdata:j.value,placeholder:"请选择科目",modelValue:h.subject}),n:e.p({label:"科目","label-width":"70",required:!0,name:"subject"}),o:e.o((e=>h.type=e)),p:e.p({localdata:e.unref(g),placeholder:"请选择班型",modelValue:h.type}),q:e.p({label:"班型","label-width":"70",required:!0,name:"type"}),r:e.o((e=>h.teacher=e)),s:e.p({placeholder:"请输入教师",modelValue:h.teacher}),t:e.p({label:"教师","label-width":"70",required:!0,name:"teacher"}),v:e.o((e=>h.classroom=e)),w:e.p({placeholder:"请输入教室",modelValue:h.classroom}),x:e.p({label:"教室","label-width":"70",required:!0,name:"classroom"}),y:e.o((e=>h.date=e)),z:e.p({type:"date",placeholder:"请选择日期",modelValue:h.date}),A:e.p({label:"日期","label-width":"70",required:!0,name:"date"}),B:e.o(_),C:e.o((e=>h.time=e)),D:e.p({modelValue:h.time}),E:e.p({label:"时间","label-width":"70",required:!0,name:"time"}),F:e.sr(l,"622d2421-8,622d2421-6",{k:"form"}),G:e.p({rules:f,model:h}),H:e.o($),I:e.o(S),J:e.sr(b,"622d2421-6",{k:"popup"}),K:e.p({type:"center"})})}},u=e._export_sfc(i,[["__scopeId","data-v-622d2421"]]);wx.createPage(u);
