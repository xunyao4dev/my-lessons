"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),o=require("../../store/lesson.js"),s=require("../../store/student.js"),n=require("../../utils/constant.js"),r=require("../../utils/utils.js"),i=require("../../utils/request.js");var a="https://lesson-api.jc-talent.com";if(!Array){(e.resolveComponent("bruce-calendar")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-swipe-action-item")+e.resolveComponent("uni-swipe-action")+e.resolveComponent("uni-fab")+e.resolveComponent("uni-notice-bar")+e.resolveComponent("uni-data-select")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("time-range-picker")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/bruce-calendar/components/bruce-calendar/bruce-calendar.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-swipe-action/components/uni-swipe-action-item/uni-swipe-action-item.js")+(()=>"../../uni_modules/uni-swipe-action/components/uni-swipe-action/uni-swipe-action.js")+(()=>"../../uni_modules/uni-fab/components/uni-fab/uni-fab.js")+(()=>"../../uni_modules/uni-notice-bar/components/uni-notice-bar/uni-notice-bar.js")+(()=>"../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/time-range-picker/components/time-range-picker/time-range-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const u={__name:"lesson",setup(u){const l=e.ref(),c=e.ref(),d=o.useLessonStore(),m=s.useStudentStore(),p=e.ref([]),h=e.ref([]),f=e.reactive([{text:"取消",style:{backgroundColor:"#F56C6C"}},{text:"完成",style:{backgroundColor:"#00f200"}}]),b=e.reactive({}),j=e.reactive({subject:{rules:[{required:!0,errorMessage:"科目不能为空"}]},teacher:{rules:[{required:!0,errorMessage:"教师不能为空"}]},classroom:{rules:[{required:!0,errorMessage:"教室不能为空"}]},date:{rules:[{required:!0,errorMessage:"日期不能为空"}]},time:{rules:[{required:!0,errorMessage:"时间不能为空"}]}}),v=e.ref(),g=()=>{v.value.open()},w=()=>{v.value.close()},$=async()=>{if(c.value){await c.value.validate()&&i.request({url:`${a}/students/${m.id}/lessons`,method:"POST",data:b,success:()=>{e.index.showToast({title:"添加成功",icon:"success"}),setTimeout((()=>{w(),l.value.init(b.date),l.value.change()}),1500)},fail:t=>{e.index.showToast({title:"网络异常",icon:"error"})}})}},q=e=>{const{year:t,month:o,date:s}=e;y(`${t}-${String(o).padStart(2,"0")}`,`${t}-${String(o).padStart(2,"0")}-${s}`)},_=e=>{const{year:t,month:o}=e;y(`${t}-${String(o).padStart(2,"0")}`)},S=e=>{b.time=e},C=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,k=(t,o)=>{i.request({url:`${a}/lessons/${t.id}`,method:"POST",data:t,success:()=>{e.index.showToast({title:o})},fail:t=>{e.index.showToast({title:"网络异常",icon:"error"})}})},y=(e,t)=>{i.request({url:`${a}/students/${d.studentId}/lessons?month=${e}&date=${t}`,method:"GET",success:e=>{const{dailySchedules:t,currentSchedules:o}=e.data.data;p.value=t.map((e=>({date:e,color:"red",icon:"flag-filled"}))),h.value=o.map((e=>({id:e.lessonId,status:e.status,subject:e.subject,classroom:e.classroom,teacher:e.teacher,time:`${e.startTime}-${e.endTime}`})))}})};return e.onBeforeMount((()=>{const e=new Date;y((e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`)(e),C(e))})),(o,s)=>({a:e.sr(l,"59e15576-0",{k:"calRef"}),b:e.o(q),c:e.o(_),d:e.p({selected:p.value,insert:!0,lunar:!0,"start-date":"2000-1-1","end-date":"2099-12-31"}),e:e.f(h.value,((o,s,n)=>e.e({a:2===o.status},2===o.status?{b:t._imports_0$1}:{},{c:e.t(e.unref(r.formatSubject)(o.subject)),d:e.t(o.time),e:"59e15576-3-"+n+",59e15576-2-"+n,f:e.t(o.classroom),g:"59e15576-4-"+n+",59e15576-2-"+n,h:e.t(o.teacher),i:o.id,j:e.o((t=>((t,o)=>{const{index:s}=t;0==s?e.index.showModal({title:"确认取消？",success:e=>{e.confirm&&(o.status=2,k(o,"取消成功"))}}):(o.status=1,k(o,"完成成功"))})(t,o)),o.id),k:"59e15576-2-"+n+",59e15576-1",l:e.p({"right-options":f,disabled:2===o.status})}))),f:e.p({type:"home",size:"16",color:"#7f8c8d"}),g:e.p({"custom-prefix":"iconfont",type:"icon-teacher",color:"#7f8c8d"}),h:e.o(g),i:e.p({horizontal:"right"}),j:e.p({"show-icon":!0,"background-color":"#eee",color:"#888",text:"将为【"+e.unref(m).name+"】添加课程"}),k:e.o((e=>b.subject=e)),l:e.p({localdata:e.unref(n.subjectOptions),placeholder:"请选择科目",modelValue:b.subject}),m:e.p({label:"科目","label-width":"70",required:!0,name:"subject"}),n:e.o((e=>b.teacher=e)),o:e.p({placeholder:"请输入教师",modelValue:b.teacher}),p:e.p({label:"教师","label-width":"70",required:!0,name:"teacher"}),q:e.o((e=>b.classroom=e)),r:e.p({placeholder:"请输入教室",modelValue:b.classroom}),s:e.p({label:"教室","label-width":"70",required:!0,name:"classroom"}),t:e.o((e=>b.date=e)),v:e.p({start:C(new Date),type:"date",placeholder:"请选择日期",modelValue:b.date}),w:e.p({label:"日期","label-width":"70",required:!0,name:"date"}),x:e.o(S),y:e.o((e=>b.time=e)),z:e.p({modelValue:b.time}),A:e.p({label:"时间","label-width":"70",required:!0,name:"time"}),B:e.sr(c,"59e15576-8,59e15576-6",{k:"form"}),C:e.p({rules:j,model:b}),D:e.o(w),E:e.o($),F:e.sr(v,"59e15576-6",{k:"popup"}),G:e.p({type:"center"})})}},l=e._export_sfc(u,[["__scopeId","data-v-59e15576"]]);wx.createPage(l);
