"use strict";const e=require("../../common/vendor.js"),t=require("../../store/lesson.js"),s=require("../../store/student.js"),o=require("../../utils/constant.js"),n=require("../../utils/utils.js"),r=require("../../utils/request.js");var i="https://lesson-api.jc-talent.com";if(!Array){(e.resolveComponent("bruce-calendar")+e.resolveComponent("uni-icons")+e.resolveComponent("uni-swipe-action-item")+e.resolveComponent("uni-swipe-action")+e.resolveComponent("uni-fab")+e.resolveComponent("uni-notice-bar")+e.resolveComponent("uni-data-select")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("time-range-picker")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/bruce-calendar/components/bruce-calendar/bruce-calendar.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-swipe-action/components/uni-swipe-action-item/uni-swipe-action-item.js")+(()=>"../../uni_modules/uni-swipe-action/components/uni-swipe-action/uni-swipe-action.js")+(()=>"../../uni_modules/uni-fab/components/uni-fab/uni-fab.js")+(()=>"../../uni_modules/uni-notice-bar/components/uni-notice-bar/uni-notice-bar.js")+(()=>"../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/time-range-picker/components/time-range-picker/time-range-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();const a={__name:"lesson",setup(a){const u=e.ref(),c=e.ref(),l=e.ref();t.useLessonStore();const d=s.useStudentStore(),p=e.ref([]),m=e.ref([]),f=e.reactive([{text:"取消",style:{backgroundColor:"#F56C6C"}},{text:"完成",style:{backgroundColor:"#00f200"}}]),b=e.reactive({}),h=e.reactive({subject:{rules:[{required:!0,errorMessage:"科目不能为空"}]},teacher:{rules:[{required:!0,errorMessage:"教师不能为空"}]},classroom:{rules:[{required:!0,errorMessage:"教室不能为空"}]},date:{rules:[{required:!0,errorMessage:"日期不能为空"}]},time:{rules:[{required:!0,errorMessage:"时间不能为空"}]}}),v=e.ref(),j=e.computed((()=>o.subjectOptions.filter((e=>d.subjects.includes(e.value))))),g=()=>{v.value.open()},w=e=>{switch(e){case 0:return"待上课";case 1:return"已上课";case 2:return"已取消"}},q=e=>{switch(e){case 0:return"is-init";case 1:return"is-approved";case 2:return"is-draft"}},y=()=>{v.value.close()},$=async()=>{if(c.value){await c.value.validate()&&e.index.requestSubscribeMessage({tmplIds:["UO10oiJFF9vEhkty7lvT7Q0DY2jXF4QdNn8WqHlVrdI","0A6-dgr7vyyrZdprmGcFEwxjpNj9vPuvRDVxw5tYI6A"],success:t=>{console.log(t),"accept"===t.UO10oiJFF9vEhkty7lvT7Q0DY2jXF4QdNn8WqHlVrdI||"accept"===t["0A6-dgr7vyyrZdprmGcFEwxjpNj9vPuvRDVxw5tYI6A"]?r.request({url:`${i}/students/${d.id}/lessons`,method:"POST",data:b,success:()=>{e.index.showToast({title:"添加成功",icon:"success"}),setTimeout((()=>{y(),u.value.init(b.date),u.value.change()}),1500)}}):e.index.showToast({title:"请允许订阅通知",icon:"error"})}})}},S=e=>{const{year:t,month:s,date:o}=e;F(`${t}-${String(s).padStart(2,"0")}`,`${t}-${String(s).padStart(2,"0")}-${o}`)},k=e=>{const{year:t,month:s}=e;F(`${t}-${String(s).padStart(2,"0")}`)},_=e=>{b.time=e},C=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,x=(t,s)=>{r.request({url:`${i}/lessons/${t.id}`,method:"POST",data:t,success:()=>{d.deductHours(),e.index.showToast({title:s})}})},F=(e,t)=>{r.request({url:`${i}/students/${d.id}/lessons?month=${e}&date=${t}`,method:"GET",success:e=>{const{dailySchedules:t,currentSchedules:s}=e.data.data;p.value=t.map((e=>({date:e,color:"red",icon:"flag-filled"}))),m.value=s.map((e=>({id:e.lessonId,status:e.status,subject:e.subject,classroom:e.classroom,teacher:e.teacher,time:`${e.startTime}-${e.endTime}`})))}})};return e.onBeforeMount((()=>{const e=new Date;F((e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`)(e),C(e))})),(t,s)=>({a:e.sr(u,"f473bd8d-0",{k:"calRef"}),b:e.o(S),c:e.o(k),d:e.p({selected:p.value,insert:!0,lunar:!0,"start-date":"2000-1-1","end-date":"2099-12-31"}),e:e.f(m.value,((t,s,o)=>({a:e.t(w(t.status)),b:e.n(q(t.status)),c:e.t(e.unref(n.formatSubject)(t.subject)),d:e.t(t.time),e:"f473bd8d-3-"+o+",f473bd8d-2-"+o,f:e.t(t.classroom),g:"f473bd8d-4-"+o+",f473bd8d-2-"+o,h:e.t(t.teacher),i:e.n({"freezon-course-info":0!==t.status}),j:t.id,k:e.o((s=>((t,s)=>{const{index:o}=t;0==o?e.index.showModal({title:"确认取消？",success:e=>{e.confirm&&(s.status=2,x(s,"取消成功"))}}):(s.status=1,x(s,"完成成功")),l.value.closeAll()})(s,t)),t.id),l:"f473bd8d-2-"+o+",f473bd8d-1",m:e.p({"right-options":f,disabled:0!==t.status})}))),f:e.p({type:"home",size:"16",color:"#7f8c8d"}),g:e.p({"custom-prefix":"iconfont",type:"icon-teacher",color:"#7f8c8d"}),h:e.sr(l,"f473bd8d-1",{k:"swipeRef"}),i:e.o(g),j:e.p({horizontal:"right"}),k:e.p({"show-icon":!0,"background-color":"#eee",color:"#888",text:"将为【"+e.unref(d).name+"】添加课程"}),l:e.o((e=>b.subject=e)),m:e.p({localdata:j.value,placeholder:"请选择科目",modelValue:b.subject}),n:e.p({label:"科目","label-width":"70",required:!0,name:"subject"}),o:e.o((e=>b.teacher=e)),p:e.p({placeholder:"请输入教师",modelValue:b.teacher}),q:e.p({label:"教师","label-width":"70",required:!0,name:"teacher"}),r:e.o((e=>b.classroom=e)),s:e.p({placeholder:"请输入教室",modelValue:b.classroom}),t:e.p({label:"教室","label-width":"70",required:!0,name:"classroom"}),v:e.o((e=>b.date=e)),w:e.p({start:C(new Date),type:"date",placeholder:"请选择日期",modelValue:b.date}),x:e.p({label:"日期","label-width":"70",required:!0,name:"date"}),y:e.o(_),z:e.o((e=>b.time=e)),A:e.p({modelValue:b.time}),B:e.p({label:"时间","label-width":"70",required:!0,name:"time"}),C:e.sr(c,"f473bd8d-8,f473bd8d-6",{k:"form"}),D:e.p({rules:h,model:b}),E:e.o(y),F:e.o($),G:e.sr(v,"f473bd8d-6",{k:"popup"}),H:e.p({type:"center"})})}},u=e._export_sfc(a,[["__scopeId","data-v-f473bd8d"]]);wx.createPage(u);
