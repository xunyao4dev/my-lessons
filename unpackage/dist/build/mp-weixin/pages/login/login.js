"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js");var o="https://lesson-api.jc-talent.com";if(!Array){e.resolveComponent("uni-icons")()}Math;const i={__name:"login",setup(i){const n=async t=>{if("getUserInfo:ok"===t.detail.errMsg){const{encryptedData:n,iv:s}=t.detail;try{e.index.showToast({title:"登录中..."});const t=await e.index.login({provider:"weixin"}),{code:i}=t;i&&e.index.request({url:`${o}/wechat/login`,method:"POST",data:{code:i,encryptedData:n,iv:s},success:t=>{const{data:o}=t.data;e.index.setStorageSync("token",o.token),e.index.showToast({title:"登录成功",success:()=>{e.index.switchTab({url:"/pages/index/index"})}})},fail:t=>{e.index.showToast({title:"网络异常",icon:"error"})}})}catch(i){e.index.showToast({title:"微信登录失败，请稍后重试"})}finally{e.index.hideToast()}}else e.index.showToast({title:"用户拒绝"})};return e.onLoad((()=>{e.index.setNavigationBarColor({frontColor:"#ffffff",backgroundColor:"#00000000"})})),(o,i)=>({a:t._imports_0,b:e.p({type:"weixin",size:"24",color:"#ffffff"}),c:e.o(n)})}};wx.createPage(i);
